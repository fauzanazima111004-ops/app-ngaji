<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>App Ngaji Pro - Lengkap</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/react@18/umd/react.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js" crossorigin></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf-autotable/3.5.31/jspdf.plugin.autotable.min.js"></script>
    <script src="https://unpkg.com/lucide@latest"></script>

    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;600;700&display=swap');
        body { background-color: #f8fafc; font-family: 'Inter', sans-serif; }
        .animate-fade { animation: fadeIn 0.3s ease-out; }
        @keyframes fadeIn { from { opacity:0; transform: translateY(10px); } to { opacity:1; transform: translateY(0); } }
        /* Cetak Rapor agar rapi */
        @media print {
            body * { visibility: hidden; }
            #area-print, #area-print * { visibility: visible; }
            #area-print { position: absolute; left: 0; top: 0; width: 100%; margin: 0; padding: 0; background: white; }
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-app.js";
        import { getAuth, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-auth.js";
        import { getFirestore, collection, addDoc, deleteDoc, updateDoc, doc, query, onSnapshot, serverTimestamp, orderBy } from "https://www.gstatic.com/firebasejs/10.8.0/firebase-firestore.js";

        // --- KONFIGURASI FIREBASE BAPAK ---
        const firebaseConfig = {
            apiKey: "AIzaSyD0XGoRIIntaMiD-xuJUJsA38-jwiz3zxs",
            authDomain: "catatan-ngaji-app.firebaseapp.com",
            projectId: "catatan-ngaji-app",
            storageBucket: "catatan-ngaji-app.firebasestorage.app",
            messagingSenderId: "642649959513",
            appId: "1:642649959513:web:497a3120235e5ce0f61548"
        };

        const app = initializeApp(firebaseConfig);
        window.db = getFirestore(app);
        window.auth = getAuth(app);
        window.fb = { collection, addDoc, deleteDoc, updateDoc, doc, query, onSnapshot, serverTimestamp, signInWithPopup, GoogleAuthProvider, signOut, onAuthStateChanged, orderBy };
    </script>

    <script type="text/babel">
        const { useState, useEffect, useRef } = React;

        // --- DATA STATIS ---
        const SURAH_LIST = ["1. Al-Fatihah", "2. Al-Baqarah", "3. Ali 'Imran", "4. An-Nisa", "5. Al-Maidah", "6. Al-An'am", "7. Al-A'raf", "8. Al-Anfal", "9. At-Taubah", "10. Yunus", "78. An-Naba", "79. An-Nazi'at", "80. 'Abasa", "81. At-Takwir", "82. Al-Infitar", "83. Al-Mutaffifin", "84. Al-Insyiqaq", "85. Al-Buruj", "86. At-Tariq", "87. Al-A'la", "88. Al-Ghasyiyah", "89. Al-Fajr", "90. Al-Balad", "91. Asy-Syams", "92. Al-Lail", "93. Ad-Duha", "94. Asy-Syarh", "95. At-Tin", "96. Al-'Alaq", "97. Al-Qadr", "98. Al-Bayyinah", "99. Az-Zalzalah", "100. Al-'Adiyat", "101. Al-Qari'ah", "102. At-Takasur", "103. Al-'Asr", "104. Al-Humazah", "105. Al-Fil", "106. Quraisy", "107. Al-Ma'un", "108. Al-Kausar", "109. Al-Kafirun", "110. An-Nasr", "111. Al-Lahab", "112. Al-Ikhlas", "113. Al-Falaq", "114. An-Nas"];
        const IQRO_LEVELS = ["Iqro 1", "Iqro 2", "Iqro 3", "Iqro 4", "Iqro 5", "Iqro 6"];

        const App = () => {
            const [user, setUser] = useState(null);
            const [activeTab, setActiveTab] = useState('input'); // input | recap | rapor | students | settings
            const [students, setStudents] = useState([]);
            const [records, setRecords] = useState([]);
            const [settings, setSettings] = useState({ tpa: '', teacher: '', logo: '' });

            // State: Input Harian (Lengkap)
            const [form, setForm] = useState({
                date: new Date().toISOString().split('T')[0], studentId: '', readingType: 'iqro', 
                iqroLevel: 'Iqro 1', iqroPage: '', iqroFluency: 'Lancar',
                quranSurah: '1. Al-Fatihah', quranAyat: '', quranFluency: 'Lancar', 
                hafalans: [{surah:'', ayat:'', fluency:''}],
                notes: ''
            });

            // State: Rapor Manual (Detail)
            const [raporForm, setRaporForm] = useState({
                studentId: '', periode: '', kelas: '',
                materiQuran: '', // Text bebas
                nilaiQuran: [
                    { aspek: 'Kelancaran Hafalan', nilai: '' },
                    { aspek: 'Ketepatan Tajwid', nilai: '' },
                    { aspek: 'Makhorijul Huruf', nilai: '' },
                    { aspek: 'Kekuatan Hafalan', nilai: '' },
                    { aspek: 'Muraja\'ah', nilai: '' }
                ],
                doa: [{ materi: '', nilai: '' }],
                hadits: [{ materi: '', nilai: '' }],
                catatan: ''
            });

            // --- LOAD DATA ---
            useEffect(() => {
                window.fb.onAuthStateChanged(window.auth, (u) => {
                    setUser(u);
                    if(u) {
                        setSettings({
                            tpa: localStorage.getItem('tpaName')||'', 
                            teacher: localStorage.getItem('teacherName')||'',
                            logo: localStorage.getItem('appLogo')||''
                        });
                        window.fb.onSnapshot(window.fb.query(window.fb.collection(window.db, 'users', u.uid, 'students'), window.fb.orderBy('name')), snap => 
                            setStudents(snap.docs.map(d=>({id:d.id, ...d.data()})))
                        );
                        window.fb.onSnapshot(window.fb.query(window.fb.collection(window.db, 'users', u.uid, 'records'), window.fb.orderBy('created_at', 'desc')), snap => 
                            setRecords(snap.docs.map(d=>({id:d.id, ...d.data()})))
                        );
                    }
                });
            }, []);

            // --- ACTIONS ---
            const handleLogin = () => window.fb.signInWithPopup(window.auth, new window.fb.GoogleAuthProvider());
            const handleLogout = () => { if(confirm("Keluar?")) window.fb.signOut(window.auth); }
            const saveSettings = () => { localStorage.setItem('tpaName', settings.tpa); localStorage.setItem('teacherName', settings.teacher); localStorage.setItem('appLogo', settings.logo); alert("Tersimpan!"); }
            const handleLogoUpload = (e) => { const f = e.target.files[0]; if(f) { const r = new FileReader(); r.onloadend = () => setSettings({...settings, logo: r.result}); r.readAsDataURL(f); } }

            // Santri
            const [newStudent, setNewStudent] = useState('');
            const saveStudent = async () => { if(newStudent){ await window.fb.addDoc(window.fb.collection(window.db, 'users', user.uid, 'students'), {name: newStudent}); setNewStudent(''); } }
            const deleteStudent = async (id) => { if(confirm("Hapus?")) await window.fb.deleteDoc(window.fb.doc(window.db, 'users', user.uid, 'students', id)); }

            // Input Harian Logika
            const addHafalanRow = () => setForm({...form, hafalans: [...form.hafalans, {surah:'', ayat:'', fluency:''}]});
            const updateHafalanRow = (idx, f, v) => { const n = [...form.hafalans]; n[idx][f] = v; setForm({...form, hafalans: n}); };
            const removeHafalanRow = (idx) => { const n = form.hafalans.filter((_, i) => i !== idx); setForm({...form, hafalans: n}); };
            const saveRecord = async (e) => {
                e.preventDefault();
                if(!form.studentId) return alert("Pilih Santri!");
                const sName = students.find(s=>s.id===form.studentId)?.name;
                await window.fb.addDoc(window.fb.collection(window.db, 'users', user.uid, 'records'), { ...form, hafalans: form.hafalans.filter(h=>h.surah), studentName: sName, created_at: window.fb.serverTimestamp() });
                alert("Data Harian Tersimpan! ‚úÖ");
                setForm({...form, notes:'', iqroPage:'', quranAyat:'', hafalans:[{surah:'', ayat:'', fluency:''}]});
            }
            const deleteRecord = async (id) => { if(confirm("Hapus?")) await window.fb.deleteDoc(window.fb.doc(window.db, 'users', user.uid, 'records', id)); }

            // Rapor Manual Logika
            const addRowRapor = (section) => setRaporForm({...raporForm, [section]: [...raporForm[section], { materi: '', nilai: '' }]});
            const removeRowRapor = (section, idx) => { const newRows = raporForm[section].filter((_, i) => i !== idx); setRaporForm({...raporForm, [section]: newRows}); }
            const updateRowRapor = (section, idx, field, value) => { const newRows = [...raporForm[section]]; newRows[idx][field] = value; setRaporForm({...raporForm, [section]: newRows}); }
            const updateNilaiQuran = (idx, value) => { const newNilai = [...raporForm.nilaiQuran]; newNilai[idx].nilai = value; setRaporForm({...raporForm, nilaiQuran: newNilai}); }

            // PDF Rapor Manual
            const generateRaporPDF = () => {
                if(!raporForm.studentId) return alert("Pilih Santri Dulu!");
                const doc = new window.jspdf.jsPDF();
                const studentName = students.find(s=>s.id === raporForm.studentId)?.name || "Santri";
                
                // Kop
                if(settings.logo) { try { doc.addImage(settings.logo, 'JPEG', 15, 10, 20, 20); } catch(e){} }
                doc.setFont("helvetica", "bold"); doc.setFontSize(16); doc.text("RAPOR PERKEMBANGAN TAHFIDZ", 105, 20, { align: "center" });
                doc.setFontSize(12); doc.setFont("helvetica", "normal"); doc.text(settings.tpa || "TPA / Rumah Qur'an", 105, 27, { align: "center" });
                doc.line(15, 32, 195, 32);

                // Identitas
                doc.setFontSize(10);
                doc.text(`Nama Santri : ${studentName}`, 15, 40); doc.text(`Kelas/Jilid : ${raporForm.kelas || '-'}`, 15, 46);
                doc.text(`Periode     : ${raporForm.periode || '-'}`, 130, 40); doc.text(`Penguji     : ${settings.teacher || '-'}`, 130, 46);

                let currentY = 55;
                // A. QURAN
                doc.setFontSize(11); doc.setFont("helvetica", "bold"); doc.setTextColor(0, 100, 0); doc.text("A. PERKEMBANGAN TAHFIDZ AL-QUR'AN", 15, currentY); currentY += 6;
                doc.setFontSize(10); doc.setTextColor(0, 0, 0); doc.text("Materi / Surat yang Diujikan:", 15, currentY); 
                doc.setFont("helvetica", "normal"); doc.text(raporForm.materiQuran || "-", 70, currentY); currentY += 4;
                
                doc.autoTable({ startY: currentY, head: [['Aspek Penilaian', 'Nilai / Predikat']], body: raporForm.nilaiQuran.map(n => [n.aspek, n.nilai]), theme: 'grid', headStyles: { fillColor: [22, 163, 74] }, columnStyles: { 0: {cellWidth: 100}, 1: {cellWidth: 80} }, margin: { left: 15 } });
                currentY = doc.lastAutoTable.finalY + 10;

                // B. DOA
                doc.setFontSize(11); doc.setFont("helvetica", "bold"); doc.setTextColor(202, 138, 4); doc.text("B. HAFALAN DOA HARIAN", 15, currentY); currentY += 2;
                doc.autoTable({ startY: currentY, head: [['No', 'Nama Doa', 'Nilai']], body: raporForm.doa.map((r, i) => [i+1, r.materi, r.nilai]), theme: 'grid', headStyles: { fillColor: [234, 179, 8] }, margin: { left: 15 } });
                currentY = doc.lastAutoTable.finalY + 10;

                // C. HADITS
                doc.setFontSize(11); doc.setFont("helvetica", "bold"); doc.setTextColor(37, 99, 235); doc.text("C. HAFALAN HADITS", 15, currentY); currentY += 2;
                doc.autoTable({ startY: currentY, head: [['No', 'Tema Hadits', 'Nilai']], body: raporForm.hadits.map((r, i) => [i+1, r.materi, r.nilai]), theme: 'grid', headStyles: { fillColor: [59, 130, 246] }, margin: { left: 15 } });
                currentY = doc.lastAutoTable.finalY + 10;

                // Catatan
                if(currentY > 240) { doc.addPage(); currentY = 20; }
                doc.setFillColor(245, 245, 245); doc.rect(15, currentY, 180, 25, 'F'); doc.setTextColor(0,0,0);
                doc.text("Catatan Ustadz/Ustadzah:", 17, currentY + 6); doc.setFont("helvetica", "normal"); doc.text(raporForm.catatan || "-", 17, currentY + 12);

                // TTD
                const signY = currentY + 40;
                doc.text("Mengetahui, Orang Tua", 15, signY); doc.text("( ........................... )", 15, signY + 25);
                doc.text("Guru Pembimbing", 140, signY); doc.text(`( ${settings.teacher || "..........................."} )`, 140, signY + 25);
                doc.save(`Rapor_${studentName}.pdf`);
            }

            if(!user) return ( <div className="min-h-screen flex items-center justify-center bg-gray-100"> <button onClick={handleLogin} className="bg-white p-6 rounded-xl shadow-xl font-bold text-blue-600">üîë Login Google</button> </div> );

            return (
                <div className="max-w-5xl mx-auto min-h-screen bg-white shadow-2xl flex flex-col md:flex-row">
                    {/* SIDEBAR / MENU */}
                    <div className="bg-slate-900 text-white md:w-64 p-4 flex flex-col gap-2 shrink-0">
                        <div className="font-bold text-xl mb-6 flex items-center gap-2">{settings.logo ? <img src={settings.logo} className="w-8 h-8 bg-white rounded"/> : "üìñ"} App Ngaji</div>
                        <button onClick={()=>setActiveTab('input')} className={`text-left p-3 rounded ${activeTab==='input'?'bg-blue-600':'hover:bg-slate-800'}`}>üìù Input Harian</button>
                        <button onClick={()=>setActiveTab('recap')} className={`text-left p-3 rounded ${activeTab==='recap'?'bg-blue-600':'hover:bg-slate-800'}`}>üìä Rekap Harian</button>
                        <button onClick={()=>setActiveTab('rapor')} className={`text-left p-3 rounded ${activeTab==='rapor'?'bg-blue-600':'hover:bg-slate-800'}`}>üéì Buat Rapor (Manual)</button>
                        <button onClick={()=>setActiveTab('students')} className={`text-left p-3 rounded ${activeTab==='students'?'bg-blue-600':'hover:bg-slate-800'}`}>üë• Data Santri</button>
                        <button onClick={()=>setActiveTab('settings')} className={`text-left p-3 rounded ${activeTab==='settings'?'bg-blue-600':'hover:bg-slate-800'}`}>‚öôÔ∏è Pengaturan</button>
                        <button onClick={handleLogout} className="text-left p-3 rounded bg-red-600 mt-auto text-xs">Keluar</button>
                    </div>

                    {/* CONTENT */}
                    <div className="flex-1 p-6 bg-slate-50 overflow-y-auto h-screen">
                        
                        {/* 1. INPUT HARIAN */}
                        {activeTab === 'input' && (
                            <div className="animate-fade space-y-4">
                                <h2 className="font-bold text-2xl text-slate-800">Input Setoran Harian</h2>
                                <form onSubmit={saveRecord} className="bg-white p-6 rounded-xl shadow border space-y-4">
                                    <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                        <div><label className="text-xs font-bold text-gray-500">TANGGAL</label><input type="date" className="w-full border p-2 rounded" value={form.date} onChange={e=>setForm({...form, date:e.target.value})}/></div>
                                        <div><label className="text-xs font-bold text-gray-500">SANTRI</label><select className="w-full border p-2 rounded font-bold" value={form.studentId} onChange={e=>setForm({...form, studentId:e.target.value})}><option value="">- Pilih -</option>{students.map(s=><option key={s.id} value={s.id}>{s.name}</option>)}</select></div>
                                    </div>
                                    
                                    {/* Materi */}
                                    <div className="bg-blue-50 p-4 rounded border border-blue-100">
                                        <div className="flex gap-4 mb-2">
                                            <label className="font-bold"><input type="radio" checked={form.readingType==='iqro'} onChange={()=>setForm({...form, readingType:'iqro'})}/> IQRO</label>
                                            <label className="font-bold"><input type="radio" checked={form.readingType==='quran'} onChange={()=>setForm({...form, readingType:'quran'})}/> AL-QURAN</label>
                                        </div>
                                        {form.readingType === 'iqro' ? (
                                            <div className="flex gap-2">
                                                <select className="border p-2 rounded" value={form.iqroLevel} onChange={e=>setForm({...form, iqroLevel:e.target.value})}>{IQRO_LEVELS.map(l=><option key={l}>{l}</option>)}</select>
                                                <input placeholder="Halaman" className="border p-2 rounded w-24" value={form.iqroPage} onChange={e=>setForm({...form, iqroPage:e.target.value})}/>
                                                <select className="border p-2 rounded" value={form.iqroFluency} onChange={e=>setForm({...form, iqroFluency:e.target.value})}><option>Lancar</option><option>Ulang</option></select>
                                            </div>
                                        ) : (
                                            <div className="flex gap-2">
                                                <select className="border p-2 rounded flex-1" value={form.quranSurah} onChange={e=>setForm({...form, quranSurah:e.target.value})}>{SURAH_LIST.map(s=><option key={s}>{s}</option>)}</select>
                                                <input placeholder="Ayat" className="border p-2 rounded w-24" value={form.quranAyat} onChange={e=>setForm({...form, quranAyat:e.target.value})}/>
                                                <select className="border p-2 rounded" value={form.quranFluency} onChange={e=>setForm({...form, quranFluency:e.target.value})}><option>Lancar</option><option>Ulang</option></select>
                                            </div>
                                        )}
                                    </div>

                                    {/* Hafalan Tambahan */}
                                    <div className="bg-purple-50 p-4 rounded border border-purple-100">
                                        <div className="flex justify-between mb-2"><span className="font-bold text-purple-800">Setoran Hafalan</span><button type="button" onClick={addHafalanRow} className="text-xs bg-white border px-2 rounded">+ Baris</button></div>
                                        {form.hafalans.map((h, i) => (
                                            <div key={i} className="flex gap-2 mb-2">
                                                <select className="flex-1 border p-1 rounded text-sm" value={h.surah} onChange={e=>updateHafalanRow(i, 'surah', e.target.value)}><option value="">- Surat -</option>{SURAH_LIST.map(s=><option key={s}>{s}</option>)}</select>
                                                <input placeholder="Ayat" className="w-20 border p-1 rounded text-sm" value={h.ayat} onChange={e=>updateHafalanRow(i, 'ayat', e.target.value)}/>
                                                <select className="w-24 border p-1 rounded text-sm" value={h.fluency} onChange={e=>updateHafalanRow(i, 'fluency', e.target.value)}><option value="">Nilai</option><option>Lancar</option><option>Ulang</option></select>
                                                {form.hafalans.length>1 && <button type="button" onClick={()=>removeHafalanRow(i)} className="text-red-500">x</button>}
                                            </div>
                                        ))}
                                    </div>

                                    <button className="w-full bg-blue-600 text-white py-3 rounded font-bold shadow hover:bg-blue-700">SIMPAN DATA HARIAN</button>
                                </form>
                            </div>
                        )}

                        {/* 2. REKAP HARIAN */}
                        {activeTab === 'recap' && (
                            <div className="animate-fade">
                                <h2 className="font-bold text-2xl text-slate-800 mb-4">Riwayat Setoran Harian</h2>
                                <div className="bg-white rounded-xl shadow border overflow-hidden">
                                    <table className="w-full text-sm text-left">
                                        <thead className="bg-slate-100 text-slate-600 font-bold">
                                            <tr><th className="p-3">Tanggal</th><th className="p-3">Nama</th><th className="p-3">Materi</th><th className="p-3">Aksi</th></tr>
                                        </thead>
                                        <tbody className="divide-y">
                                            {records.map(r=>(
                                                <tr key={r.id} className="hover:bg-slate-50">
                                                    <td className="p-3">{r.date}</td>
                                                    <td className="p-3 font-bold">{r.studentName}</td>
                                                    <td className="p-3">
                                                        <div>{r.readingType==='iqro' ? `${r.iqroLevel} Hal ${r.iqroPage}` : `${r.quranSurah} : ${r.quranAyat}`}</div>
                                                        {(r.hafalans||[]).filter(h=>h.surah).map((h,i)=><div key={i} className="text-xs text-purple-600">‚≠ê {h.surah}:{h.ayat} ({h.fluency})</div>)}
                                                    </td>
                                                    <td className="p-3"><button onClick={()=>deleteRecord(r.id)} className="text-red-500 hover:text-red-700"><lucide-trash size={16}/></button>Hapus</td>
                                                </tr>
                                            ))}
                                        </tbody>
                                    </table>
                                </div>
                            </div>
                        )}

                        {/* 3. RAPOR MANUAL */}
                        {activeTab === 'rapor' && (
                            <div className="animate-fade bg-white p-6 rounded-xl shadow-lg border">
                                <h2 className="font-bold text-xl mb-6 text-center text-slate-800 border-b pb-4">üéì FORM RAPOR MANUAL</h2>
                                {/* Identitas */}
                                <div className="grid grid-cols-1 md:grid-cols-3 gap-3 mb-6 bg-slate-50 p-4 rounded-lg">
                                    <div><label className="text-xs font-bold text-gray-500">SANTRI</label><select className="w-full border p-2 rounded font-bold" value={raporForm.studentId} onChange={e=>setRaporForm({...raporForm, studentId:e.target.value})}><option value="">- Pilih -</option>{students.map(s=><option key={s.id} value={s.id}>{s.name}</option>)}</select></div>
                                    <div><label className="text-xs font-bold text-gray-500">PERIODE</label><input placeholder="Januari 2026" className="w-full border p-2 rounded" value={raporForm.periode} onChange={e=>setRaporForm({...raporForm, periode:e.target.value})}/></div>
                                    <div><label className="text-xs font-bold text-gray-500">KELAS</label><input placeholder="Tahfidz" className="w-full border p-2 rounded" value={raporForm.kelas} onChange={e=>setRaporForm({...raporForm, kelas:e.target.value})}/></div>
                                </div>

                                {/* A. QURAN */}
                                <div className="mb-6 border rounded-lg overflow-hidden">
                                    <div className="bg-green-100 p-3 font-bold text-green-800">A. PENILAIAN AL-QUR'AN</div>
                                    <div className="p-4 space-y-4">
                                        <div><label className="font-bold text-sm block mb-1">Materi / Surat yang Diujikan:</label><textarea placeholder="Contoh: Surat An-Naba s/d Al-Insyiqaq (Lancar)" className="w-full border p-2 rounded h-16" value={raporForm.materiQuran} onChange={e=>setRaporForm({...raporForm, materiQuran:e.target.value})}/></div>
                                        <div className="grid grid-cols-1 md:grid-cols-2 gap-4">
                                            {raporForm.nilaiQuran.map((item, idx) => (
                                                <div key={idx} className="flex flex-col"><label className="text-xs font-bold text-gray-500 mb-1">{item.aspek.toUpperCase()}</label><input placeholder="Nilai (A/B/C atau 90)" className="border p-2 rounded font-bold" value={item.nilai} onChange={e=>updateNilaiQuran(idx, e.target.value)}/></div>
                                            ))}
                                        </div>
                                    </div>
                                </div>

                                {/* B & C. DOA HADITS */}
                                <div className="grid grid-cols-1 md:grid-cols-2 gap-6 mb-6">
                                    <div className="border rounded-lg p-3 bg-yellow-50">
                                        <div className="flex justify-between mb-2"><span className="font-bold text-yellow-800">B. DOA</span><button onClick={()=>addRowRapor('doa')} className="text-xs bg-white border px-2 rounded">+ Baris</button></div>
                                        {raporForm.doa.map((r, i) => (<div key={i} className="flex gap-2 mb-2"><input placeholder="Nama Doa" className="flex-1 border p-1 rounded text-sm" value={r.materi} onChange={e=>updateRowRapor('doa', i, 'materi', e.target.value)}/><input placeholder="Nilai" className="w-20 border p-1 rounded text-sm" value={r.nilai} onChange={e=>updateRowRapor('doa', i, 'nilai', e.target.value)}/>{raporForm.doa.length>1 && <button onClick={()=>removeRowRapor('doa',i)} className="text-red-500 font-bold">x</button>}</div>))}
                                    </div>
                                    <div className="border rounded-lg p-3 bg-blue-50">
                                        <div className="flex justify-between mb-2"><span className="font-bold text-blue-800">C. HADITS</span><button onClick={()=>addRowRapor('hadits')} className="text-xs bg-white border px-2 rounded">+ Baris</button></div>
                                        {raporForm.hadits.map((r, i) => (<div key={i} className="flex gap-2 mb-2"><input placeholder="Tema Hadits" className="flex-1 border p-1 rounded text-sm" value={r.materi} onChange={e=>updateRowRapor('hadits', i, 'materi', e.target.value)}/><input placeholder="Nilai" className="w-20 border p-1 rounded text-sm" value={r.nilai} onChange={e=>updateRowRapor('hadits', i, 'nilai', e.target.value)}/>{raporForm.hadits.length>1 && <button onClick={()=>removeRowRapor('hadits',i)} className="text-red-500 font-bold">x</button>}</div>))}
                                    </div>
                                </div>

                                <div className="mb-6"><label className="font-bold text-sm block mb-1">Catatan Ustadz/Ustadzah:</label><textarea className="w-full border p-2 rounded h-20" placeholder="Pesan untuk orang tua..." value={raporForm.catatan} onChange={e=>setRaporForm({...raporForm, catatan:e.target.value})}/></div>
                                <button onClick={generateRaporPDF} className="w-full bg-slate-800 text-white py-4 rounded-xl font-bold shadow hover:bg-slate-700 flex justify-center items-center gap-2">üñ®Ô∏è CETAK RAPOR PDF</button>
                            </div>
                        )}

                        {/* 4. SETTING & SANTRI */}
                        {(activeTab === 'settings' || activeTab === 'students') && (
                            <div className="animate-fade space-y-6">
                                {activeTab === 'settings' && <div className="bg-white p-4 rounded-xl shadow border"><h3 className="font-bold mb-2">Lembaga</h3><input type="file" onChange={handleLogoUpload} className="mb-2 text-sm"/><input placeholder="Nama TPA" className="w-full border p-2 rounded mb-2" value={settings.tpa} onChange={e=>setSettings({...settings, tpa:e.target.value})}/><input placeholder="Nama Guru" className="w-full border p-2 rounded mb-2" value={settings.teacher} onChange={e=>setSettings({...settings, teacher:e.target.value})}/><button onClick={saveSettings} className="bg-green-600 text-white px-4 py-2 rounded">Simpan</button></div>}
                                {activeTab === 'students' && <div className="bg-white p-4 rounded-xl shadow border"><h3 className="font-bold mb-2">Data Santri</h3><div className="flex gap-2 mb-4"><input placeholder="Nama Baru..." className="flex-1 border p-2 rounded" value={newStudent} onChange={e=>setNewStudent(e.target.value)}/><button onClick={saveStudent} className="bg-blue-600 text-white px-4 rounded">Tambah</button></div>{students.map(s=>(<div key={s.id} className="flex justify-between border-b py-2"><span>{s.name}</span><button onClick={()=>deleteStudent(s.id)} className="text-red-500 text-xs">Hapus</button></div>))}</div>}
                            </div>
                        )}

                    </div>
                </div>
            );
        }

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<App />);
    </script>
</body>
</html>
